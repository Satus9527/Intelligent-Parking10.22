# 智能停车场项目开发规则手册

## 1. 代码规范

### 1.1 命名规范
| 类型 | 命名规则 | 示例 |
|-----|---------|------|
| 文件夹/文件 | kebab-case | `parking-list`, `user-info.js` |
| 组件/页面 | PascalCase | `ParkingCard`, `ReservationForm` |
| 变量/函数 | camelCase | `handleReservation`, `userInfo` |
| 常量 | UPPER_SNAKE_CASE | `MAX_RESERVATION_TIME`, `API_BASE_URL` |
| 数据库表 | snake_case | `parking_space`, `user_reservation` |

### 1.2 代码格式要求
- **缩进**：使用2个空格缩进
- **换行**：每行代码不超过80个字符
- **括号**：函数/条件语句括号使用K&R风格
- **分号**：JavaScript代码句末必须加分号
- **空格**：运算符前后、逗号后必须加空格

### 1.3 注释规范
- **单行注释**：`// 注释内容`（单独一行时缩进与代码一致）
- **多行注释**：`/* 注释内容 */`（避免使用，优先拆分为单行注释）
- **函数注释**：使用JSDoc格式
  ```javascript
  /**
   * 预约车位处理函数
   * @param {Object} params - 预约参数
   * @param {string} params.parkingId - 停车场ID
   * @param {string} params.spaceId - 车位ID
   * @param {string} params.plate - 车牌号
   * @returns {Promise<Object>} 预约结果
   */
  async function reserveParkingSpace(params) { ... }
  ```

## 2. 版本控制规则

### 2.1 分支管理策略
| 分支类型 | 命名格式 | 用途 | 合并规则 |
|---------|---------|------|---------|
| 主分支 | `main` | 生产环境代码 | 仅接受`release/*`合并 |
| 开发分支 | `develop` | 开发集成分支 | 接受`feature/*`和`fix/*`合并 |
| 功能分支 | `feature/XXX-描述` | 新功能开发 | 完成后合并到`develop` |
| 修复分支 | `fix/XXX-描述` | 缺陷修复 | 完成后合并到`develop`和`main` |
| 发布分支 | `release/VX.Y.Z` | 版本发布准备 | 测试通过后合并到`main`和`develop` |
| 临时分支 | `hotfix/XXX-描述` | 生产环境紧急修复 | 完成后合并到`main`和`develop` |

### 2.2 提交信息规范
- **格式**：`类型(范围): 描述`
- **类型**：
  - `feat`: 新功能
  - `fix`: 缺陷修复
  - `docs`: 文档更新
  - `style`: 代码格式调整（不影响逻辑）
  - `refactor`: 代码重构
  - `test`: 测试相关
  - `chore`: 构建/依赖管理
- **示例**：`feat(reservation): 添加车位预约锁定功能`

### 2.3 代码审查要求
- 所有合并到`develop`及以上分支的代码必须通过Pull Request
- 至少需要1名团队成员的审查批准
- 自动化测试必须全部通过
- 代码风格检查必须通过（使用ESLint）

## 3. 测试规范

### 3.1 测试类型要求
| 测试类型 | 覆盖率要求 | 工具 | 执行时机 |
|---------|----------|------|---------|
| 单元测试 | 服务层代码>80% | Jest | 提交代码前 |
| 接口测试 | 所有API>95% | Postman | 每日构建后 |
| UI测试 | 核心流程>90% | 微信小程序测试框架 | 功能完成后 |
| 性能测试 | 支持200并发用户 | JMeter | 发布前 |

### 3.2 测试用例规范
- 测试用例必须包含：ID、模块、前置条件、操作步骤、预期结果、优先级
- 关键业务流程必须编写自动化测试脚本
- 测试数据必须使用模拟数据，禁止使用生产环境数据
- 测试结果必须记录到测试管理系统

## 4. 文档规范

### 4.1 文档类型及要求
| 文档类型 | 责任人 | 更新时机 | 存储位置 |
|---------|-------|---------|---------|
| 需求文档 | 产品经理 | 需求变更时 | /docs/requirements |
| 设计文档 | 架构师 | 设计变更时 | /docs/design |
| API文档 | 开发工程师 | 接口变更时 | /docs/api |
| 用户手册 | 产品经理 | 功能上线前 | /docs/manual |
| 测试报告 | 测试工程师 | 测试完成后 | /docs/test |

### 4.2 文档格式要求
- 统一使用Markdown格式（.md文件）
- 标题层级使用`#`号表示（#一级，##二级，###三级）
- 代码块使用```语言标识（```javascript, ```java等）
- 表格使用Markdown标准表格语法
- 图片存储在`/docs/images`目录，使用相对路径引用

## 5. 安全规范

### 5.1 数据安全要求
- 用户敏感信息（手机号、车牌号）必须脱敏存储
- 密码必须使用BCrypt等算法加密存储，禁止明文存储
- 传输数据必须使用HTTPS协议
- 数据库连接字符串必须使用环境变量注入，禁止硬编码

### 5.2 接口安全要求
- 所有接口必须进行身份验证（JWT令牌）
- 敏感操作必须进行权限校验
- API请求必须添加请求签名，防止篡改
- 实现接口限流机制，防止恶意请求

### 5.3 代码安全要求
- 禁止使用`eval()`等危险函数
- 输入数据必须进行验证和过滤，防止XSS攻击
- SQL操作必须使用参数化查询，防止SQL注入
- 定期进行代码安全扫描

## 6. 构建与部署规范

### 6.1 构建流程
- 使用npm scripts定义构建命令：
  - `npm run dev`: 开发环境构建
  - `npm run build`: 生产环境构建
  - `npm run test`: 运行测试
- 构建过程必须包含代码 lint 检查
- 生产环境构建必须开启代码压缩和混淆

### 6.2 部署要求
- 开发环境：自动部署（每次合并到develop分支）
- 测试环境：手动触发部署
- 生产环境：审批后部署，必须有回滚方案
- 部署必须保留版本记录，支持一键回滚
- 所有环境配置必须使用环境变量，禁止硬编码

## 7. 项目会议规范

### 7.1 会议类型及频率
| 会议类型 | 频率 | 参会人员 | 会议产出 |
|---------|------|---------|---------|
| 每日站会 | 工作日每天10:00 | 全体开发人员 | 进度更新/问题 blockers |
| 周例会 | 每周五16:00 | 全体项目成员 | 周报/计划/问题跟踪 |
| 需求评审会 | 需求变更时 | 产品/开发/测试 | 需求文档确认 |
| 技术评审会 | 设计完成后 | 开发/架构/测试 | 设计文档确认 |
| 发布规划会 | 版本发布前一周 | 全体项目成员 | 发布计划/风险评估 |

### 7.2 会议管理要求
- 会议必须提前发送议程
- 会议时长控制：站会≤15分钟，例会≤60分钟
- 会议必须有记录，发送给所有参会人员
- 会议决议必须明确责任人与完成时间

## 8. 项目交付标准

### 8.1 功能交付标准
- 符合需求文档描述，通过需求验证
- 单元测试覆盖率达到要求
- 无阻塞性缺陷
- 用户界面符合UI设计规范
- 性能指标达到要求

### 8.2 文档交付标准
- 所有必需文档完整且最新
- 文档格式符合项目规范
- 技术文档包含必要的图表说明
- 用户文档语言通俗易懂

### 8.3 代码交付标准
- 通过所有自动化测试和代码审查
- 符合项目代码规范
- 无性能问题和安全漏洞
- 包含必要的注释和文档字符串