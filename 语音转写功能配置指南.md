# 语音转写功能配置指南

## 问题说明

如果遇到错误：`[插件 wx3030a84d9f33b5c6] provider:wx3030a84d9f33b5c6, version:0.3.5, 获取不到插件内容`

这是因为微信同声传译插件需要在微信公众平台后台添加后才能使用。

## 解决方案

### 方案一：添加微信同声传译插件（推荐）

#### 步骤1：登录微信公众平台

1. 访问 [微信公众平台](https://mp.weixin.qq.com/)
2. 使用小程序管理员账号登录

#### 步骤2：添加插件

1. 在左侧菜单中，点击 **"设置"** > **"第三方服务"** > **"插件管理"**
2. 点击 **"添加插件"** 按钮
3. 在搜索框中输入插件AppID：`wx3030a84d9f33b5c6`
4. 或者搜索插件名称：**"同声传译"**
5. 找到插件后，点击 **"添加"**
6. 等待审核通过（通常需要几分钟到几小时）

#### 步骤3：验证配置

1. 在 `app.json` 中确认插件配置：
```json
{
  "plugins": {
    "WechatSI": {
      "version": "0.3.5",
      "provider": "wx3030a84d9f33b5c6"
    }
  }
}
```

2. 在微信开发者工具中：
   - 点击 **"工具"** > **"清缓存"** > **"清除数据缓存"**
   - 重新编译项目
   - 检查是否还有插件错误

#### 步骤4：测试功能

1. 打开小程序首页
2. 点击搜索栏右侧的麦克风图标
3. 按住"按住说话"按钮
4. 说话后松开，查看识别结果

---

### 方案二：使用原生录音API（无需插件）

如果暂时无法添加插件，代码已兼容原生录音API。但需要注意：

#### 当前实现方式

1. **代码已自动兼容**：如果插件未配置，会自动使用微信原生录音API
2. **需要后端支持**：原生API只能录音，需要后端实现语音识别接口

#### 后端需要实现的接口

**接口地址：** `POST /api/v1/voice/upload`

**请求格式：** multipart/form-data

**参数：**
- `audio`: 音频文件（mp3格式）
- `format`: 音频格式（如 "mp3"）

**响应示例：**
```json
{
  "status": "success",
  "text": "识别到的文字内容",
  "message": "识别成功"
}
```

#### 后端实现示例（Java Spring Boot）

```java
@PostMapping("/upload")
public ResponseEntity<ResultDTO> uploadVoice(@RequestParam("audio") MultipartFile audioFile) {
    try {
        // 1. 保存音频文件
        String filePath = saveAudioFile(audioFile);
        
        // 2. 调用讯飞语音识别API（或其他语音识别服务）
        String text = callSpeechRecognitionAPI(filePath);
        
        // 3. 返回识别结果
        Map<String, Object> data = new HashMap<>();
        data.put("text", text);
        return ResponseEntity.ok(ResultDTO.success(data));
    } catch (Exception e) {
        return ResponseEntity.ok(ResultDTO.fail("识别失败: " + e.getMessage()));
    }
}
```

---

## 方案对比

| 特性 | 微信同声传译插件 | 原生录音API + 后端识别 |
|------|----------------|---------------------|
| 配置难度 | 需要后台添加插件 | 无需配置插件 |
| 识别速度 | 实时识别，速度快 | 需要上传文件，速度较慢 |
| 网络要求 | 需要网络 | 需要网络 |
| 费用 | 免费（有使用限制） | 需要后端语音识别服务费用 |
| 识别准确度 | 高 | 取决于后端服务 |
| 推荐度 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |

---

## 故障排查

### 问题1：插件已添加但仍报错

**解决方法：**
1. 检查小程序AppID是否正确
2. 清除微信开发者工具缓存
3. 重新编译项目
4. 确认插件状态为"已通过"

### 问题2：录音权限被拒绝

**解决方法：**
1. 在微信中打开小程序
2. 点击右上角"..." > "设置"
3. 开启"录音"权限

### 问题3：原生API录音后无法识别

**解决方法：**
1. 确认后端已实现 `/api/v1/voice/upload` 接口
2. 检查网络连接
3. 查看后端日志是否有错误

---

## 推荐配置

**开发环境：** 使用原生录音API，避免插件审核等待

**生产环境：** 使用微信同声传译插件，体验更好

---

## 注意事项

1. **插件审核时间**：插件添加后需要审核，通常几分钟到几小时
2. **使用限制**：微信同声传译插件有每日调用次数限制
3. **网络要求**：两种方案都需要网络连接
4. **权限要求**：需要用户授权录音权限

---

## 相关文档

- [微信小程序插件开发文档](https://developers.weixin.qq.com/miniprogram/dev/framework/plugin/)
- [微信同声传译插件文档](https://mp.weixin.qq.com/wxopen/plugindevdoc?appid=wx3030a84d9f33b5c6)
- [录音管理器API文档](https://developers.weixin.qq.com/miniprogram/dev/api/media/recorder/wx.getRecorderManager.html)

